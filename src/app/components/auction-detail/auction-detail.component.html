<!-- ============================================================ -->
<!-- AUCTION DETAIL — View auction info, place bids, bid history  -->
<!-- ============================================================ -->

@if (auction) {
  <a routerLink="/auctions" class="back-link">&larr; Back to Auctions</a>

  <div class="auction-detail">
    <!-- ── Auction Image ───────────────────────────────────── -->
    <div class="detail-image">
      <img [src]="auction.imageUrl" [alt]="auction.title" />
      @if (auction.status !== 'active') {
        <div class="image-overlay">
          <span class="overlay-status">{{ auction.status | titlecase }}</span>
        </div>
      }
    </div>

    <!-- ── Auction Info ────────────────────────────────────── -->
    <div class="detail-info">
      <span class="detail-category">{{ auction.category }}</span>
      <h1 class="detail-title">{{ auction.title }}</h1>
      <span class="seller-info">Listed by <strong>{{ auction.sellerName }}</strong></span>

      <!-- Price Section -->
      <div class="price-section">
        <div class="current-bid-block">
          <span class="price-label">Current Bid</span>
          <span class="current-price">{{ auction.currentPrice | currency:'USD' }}</span>
        </div>
        <div class="price-meta">
          <span class="bid-count-lg">{{ auction.bidCount }} bid{{ auction.bidCount !== 1 ? 's' : '' }}</span>
          <span class="starting-price">Starting: {{ auction.startingPrice | currency:'USD' }}</span>
        </div>
      </div>

      <!-- Countdown Timer -->
      <div class="timer-section" [ngClass]="getTimerClass()">
        @if (auction.status === 'active') {
          <span class="timer-icon-lg">&#9202;</span>
          <div class="timer-info">
            <span class="timer-label">Time Remaining</span>
            <span class="timer-value">{{ timeRemaining }}</span>
          </div>
        } @else {
          <span class="status-badge" [ngClass]="'status-' + auction.status">
            {{ auction.status | titlecase }}
          </span>
          @if (auction.winnerName) {
            <span class="winner-info">Won by {{ auction.winnerName }}</span>
          }
        }
      </div>

      <!-- Bid Form -->
      @if (canBid) {
        <div class="bid-form">
          <label class="bid-label">
            Your Bid <span class="bid-min">(min {{ minimumBid | currency:'USD' }})</span>
          </label>
          <div class="bid-input-row">
            <span class="currency-prefix">$</span>
            <input type="number"
                   [(ngModel)]="bidAmount"
                   [min]="minimumBid"
                   step="1.00"
                   class="bid-input" />
            <button (click)="placeBid()"
                    [disabled]="bidAmount < minimumBid"
                    class="btn-place-bid">
              Place Bid
            </button>
          </div>
          @if (bidError) {
            <div class="alert alert-error">{{ bidError }}</div>
          }
        </div>
      } @else if (!authService.isLoggedIn()) {
        <a routerLink="/login" class="btn-login-bid">Log in to place a bid</a>
      } @else if (isOwnAuction) {
        <div class="own-auction-notice">
          You cannot bid on your own auction.
        </div>
      }

      <!-- Description -->
      <div class="detail-description">
        <h3>Description</h3>
        <p>{{ auction.description }}</p>
      </div>
    </div>
  </div>

  <!-- ── Bid History ───────────────────────────────────────── -->
  <section class="bid-history-section">
    <h2>Bid History</h2>
    @if (bids.length > 0) {
      <div class="bid-list">
        @for (bid of bids; track bid.id; let i = $index) {
          <div class="bid-card" [class.winning-bid]="i === 0">
            <div class="bid-card-left">
              @if (i === 0) {
                <span class="bid-rank crown">&#128081;</span>
              } @else {
                <span class="bid-rank">#{{ i + 1 }}</span>
              }
              <div class="bid-info">
                <span class="bid-bidder">{{ bid.bidderName }}</span>
                <span class="bid-date">{{ formatDate(bid.createdAt) }}</span>
              </div>
            </div>
            <span class="bid-amount">{{ bid.amount | currency:'USD' }}</span>
          </div>
        }
      </div>
    } @else {
      <div class="bid-empty">
        <p>No bids yet. Be the first to bid!</p>
      </div>
    }
  </section>

} @else {
  <div class="loading">
    <p>Loading auction...</p>
  </div>
}
