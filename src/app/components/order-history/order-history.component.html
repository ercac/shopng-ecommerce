<!-- ============================================================ -->
<!-- ORDER HISTORY â€” User's past orders (storefront view)        -->
<!-- ============================================================ -->

<div class="order-history-page">
  <div class="order-history-container">

    <div class="page-header">
      <h1>My Orders</h1>
      <p class="subtitle">Track and review your past purchases.</p>
    </div>

    @if (loading) {
      <div class="loading-state">
        <p>Loading your orders...</p>
      </div>
    } @else if (orders.length === 0) {
      <!-- Empty State -->
      <div class="empty-state">
        <div class="empty-icon">ðŸ“¦</div>
        <h2>No orders yet</h2>
        <p>Looks like you haven't placed any orders. Start shopping to see them here!</p>
        <a routerLink="/products" class="btn-shop">Browse Products</a>
      </div>
    } @else {
      <!-- Order Cards -->
      <div class="orders-list">
        @for (order of orders; track order.id) {
          <div
            class="order-card"
            [class.expanded]="expandedOrderId === order.id"
            [class.cancelled]="order.status === 'cancelled'"
          >
            <!-- Order Summary Row (always visible) -->
            <div class="order-summary" (click)="toggleExpand(order.id)">
              <div class="order-left">
                <span class="order-number">{{ order.orderNumber }}</span>
                <span class="order-date">{{ formatDate(order.created_at) }}</span>
              </div>
              <div class="order-right">
                <span class="order-items-count">
                  {{ order.items?.length || 0 }} item{{ (order.items?.length || 0) !== 1 ? 's' : '' }}
                </span>
                <span class="order-total">{{ order.total | currency }}</span>
                <span class="status-badge" [ngClass]="getStatusClass(order.status)">
                  {{ order.status }}
                </span>
                <span class="expand-arrow" [class.rotated]="expandedOrderId === order.id">â–¼</span>
              </div>
            </div>

            <!-- Expanded Detail (toggled) -->
            @if (expandedOrderId === order.id) {
              <div class="order-details">

                <!-- Line Items -->
                <div class="detail-section">
                  <h3>Items</h3>
                  @for (item of order.items; track item.id) {
                    <div class="item-row">
                      <img [src]="item.image" [alt]="item.name" class="item-thumb" />
                      <div class="item-info">
                        <span class="item-name">{{ item.name }}</span>
                        <span class="item-meta">{{ item.category }} &middot; Qty: {{ item.quantity }}</span>
                      </div>
                      <span class="item-price">{{ item.price_at_purchase * item.quantity | currency }}</span>
                    </div>
                  }
                </div>

                <!-- Cost Breakdown -->
                <div class="detail-section">
                  <h3>Order Total</h3>
                  <div class="cost-breakdown">
                    <div class="cost-line">
                      <span>Subtotal</span>
                      <span>{{ order.subtotal | currency }}</span>
                    </div>
                    <div class="cost-line">
                      <span>Tax (8.25%)</span>
                      <span>{{ order.tax | currency }}</span>
                    </div>
                    <div class="cost-line">
                      <span>Shipping &amp; Fees</span>
                      <span>{{ order.fees | currency }}</span>
                    </div>
                    <div class="cost-line cost-total-line">
                      <span>Total</span>
                      <span>{{ order.total | currency }}</span>
                    </div>
                  </div>
                </div>

                <!-- Shipping Address -->
                <div class="detail-section">
                  <h3>Shipped To</h3>
                  <p class="address">{{ order.shipping_address }}</p>
                </div>
              </div>
            }
          </div>
        }
      </div>
    }
  </div>
</div>
